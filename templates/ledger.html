{% extends "base.html" %}
{% block content %}
  <div class="card">
    <div class="row" style="align-items:center;">
      <h2 style="margin:0;">{{ kid.name }} â€” Wallet</h2>
      <div class="spacer"></div>
      <a class="btn" href="{{ url_for('board', filter_kid=kid.id) }}">View on board</a>
      <a class="btn" href="{{ url_for('board') }}">Back</a>
    </div>

    <div class="row" style="margin-top:10px;flex-wrap:wrap;">
      <div class="card" style="flex:1;min-width:240px;">
        <div class="muted">Balance</div>
        <div style="font-size:28px;font-weight:900;">{{ balance }} pts</div>
        <div class="muted">Months covered (approx): {{ "%.2f"|format(months_covered) }}</div>
      </div>

      <div class="card" style="flex:1;min-width:240px;">
        <div class="row" style="align-items:center;">
          <strong>Rent Policy</strong>
          <div class="spacer"></div>
          <form method="post" action="{{ url_for('charge_rent') }}">
            <button class="btn" type="submit">Charge rent now</button>
          </form>
        </div>

        <form method="post" action="{{ url_for('update_rent', kid_id=kid.id) }}" class="stack" style="margin-top:10px;">
          <label class="muted">Rent amount (points)</label>
          <input type="number" name="rent_amount" min="0" value="{{rent_policy.rent_amount}}" />
          <label class="muted">Rent day of month (1-28)</label>
          <input type="number" name="rent_day_of_month" min="1" max="28" value="{{rent_policy.rent_day_of_month}}" />
          <button class="btn primary" type="submit">Save rent settings</button>
          <div class="muted">Last charged: {{ rent_policy.last_charged_on or "never" }}</div>
        </form>
      </div>

      <div class="card" style="flex:1;min-width:240px;">
        <strong>Manual adjustment</strong>
        <form method="post" action="{{ url_for('adjust', kid_id=kid.id) }}" class="stack" style="margin-top:10px;">
          <label class="muted">Amount (can be negative)</label>
          <input type="number" name="amount" value="0" />
          <label class="muted">Note</label>
          <input name="note" placeholder="e.g., Bonus for great attitude" />
          <button class="btn" type="submit">Post adjustment</button>
        </form>
      </div>
    </div>

    <h3 style="margin-top:18px;">Journal</h3>
    <div class="table">
      <div class="thead">
        <div>Date</div><div>Amount</div><div>Reason</div><div>Note</div>
      </div>
      {% for e in entries %}
        <div class="trow">
          <div class="muted">{{ e.created_at | format_approved }}</div>
          <div style="font-weight:900; color: {% if e.amount>=0 %}#86efac{% else %}#fca5a5{% endif %};">
            {{ e.amount }}
          </div>
          <div class="muted">{{ e.reason.value }}</div>
          <div class="muted">{{ e.note }}</div>
        </div>
      {% endfor %}
      {% if entries|length == 0 %}
        <div class="muted" style="margin-top:10px;">No ledger entries yet.</div>
      {% endif %}
    </div>
  </div>
{% endblock %}
